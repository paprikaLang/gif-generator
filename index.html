<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdn.bootcss.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
	<script src="https://cdn.bootcss.com/fabric.js/2.2.3/fabric.min.js"></script>
	<script src="https://cdn.bootcss.com/downloadjs/1.4.7/download.min.js"></script>
	<link href="https://cdn.bootcss.com/bootstrap/4.1.0/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="main.css">
	<title>Gif-Generator</title>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
          <div class="sidebar-sticky">
            <!-- source material -->
          </div>
        </nav>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Gif-Generator</h1>
          </div>

          <canvas class="w-100" id="myAvatar" width="460" height="460"></canvas>
          <div class="download">
          	<button class="btn btn-primary" onclick="downloadit()">下载图片</button>
          	<button class="btn btn-outline-second" onclick="debug()">调试</button>
          </div>
        </main>
    </div>
</div>
<script>
	var canvas = new fabric.Canvas('myAvatar',{
		//actived 的图片是否永远在最上面
		preserveObjectStacking: true
	});
	var rect = new fabric.Rect({
		left: 100,
		top: 100,
		fill: 'red',
		width: 20,
		height: 20
	});
	canvas.insertAt(rect,0);
	const debugTool = {
		cornerSize: 10,
		padding: 5 ,
		transparentCorners: true,
		cornerStyle: 'circle',
		cornerColor: 'red',
		borderColor: 'red'}

	fabric.Image.fromURL('avatar.png',function(oImg) {
		canvas.insertAt(oImg,1);
		oImg.set('scaleX',0.6);
		oImg.set('scaleY',0.6);
		oImg.set('top', 80);
		oImg.set('left',40);
		oImg.set(debugTool);
	});
	const text = new fabric.Text('boring cookie no eat',{
		left: 100,
		top: 100,
		fill:'white',
		scale: 0.6,
		left: 70,
		...debugTool
	});
	canvas.insertAt(text,2);
	function downloadit() {
		//console.log(canvas.toDataURL('png'));//data:image/png;base64,iVBORw0KGg.....
		download(canvas.toDataURL('png'),"avatar.png","image/png");
	};
	function debug() {
		const activedObj = canvas.getActiveObject();
		console.log(`angle = ${activedObj.angle}`);
		console.log(`scaleX = ${activedObj.scaleX}`);
		console.log(`scaleY = ${activedObj.scaleY}`);
		console.log(`top = ${activedObj.top}`);
		console.log(`left = ${activedObj.left}`);

	}
</script>

</body>
</html>







