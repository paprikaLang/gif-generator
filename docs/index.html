<!DOCTYPE html><html> <head> <meta charset="utf-8"> <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script> <script src="https://cdn.bootcss.com/bootstrap/4.1.0/js/bootstrap.min.js"></script> <script src="https://cdn.bootcss.com/fabric.js/2.2.3/fabric.min.js"></script> <script src="https://cdn.bootcss.com/downloadjs/1.4.7/download.min.js"></script> <script src="https://cdn.bootcss.com/keypress/2.1.5/keypress.min.js"></script> <script src="https://cdn.bootcss.com/gif.js/0.2.0/gif.js"></script> <link href="https://cdn.bootcss.com/bootstrap/4.1.0/css/bootstrap.min.css" rel="stylesheet"> <link rel="stylesheet" type="text/css" href="/main.843c77b1.css"> <title>Gif-Generator</title> <style type="text/css">canvas{border:1px solid #eee}.download{margin-top:50px}.editBar{margin-top:10px}.editBar input{max-width:300px}.gif-images>li{display:inline-block;margin-right:5px}.gif-images{padding:0}</style> </head> <body> <div class="container-fluid"> <div class="row"> <nav class="col-md-2 d-none d-md-block bg-light sidebar"> <div class="sidebar-sticky">  </div> </nav> <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4"> <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"> <h1 class="h2">Gif-Generator</h1> </div> <canvas class="w-100" id="myAvatar" width="460" height="460"></canvas> <div class="download"> <button class="btn btn-primary" onclick="downloadit()">下载图片</button> <button class="btn btn-outline-second" onclick="debug()">调 试</button> <button class="btn btn-outline-second" onclick="pic_concat()">加入动图序列</button> <button class="btn btn-outline-second" onclick="gif_generate()">下载动图</button> </div> <div class="form-group editBar"> <input type="text" id="editText" class="form-control" placeholder="点击文本修改内容" disabled onchange="update_text()"> </div> <div class="gif-images"></div> </main> </div> </div> <script>var canvas=new fabric.Canvas("myAvatar",{preserveObjectStacking:!0});canvas.backgroundColor="rgba(255,255,255,1)";const debugTool={cornerSize:10,padding:5,transparentCorners:!0,cornerStyle:"circle",cornerColor:"red",borderColor:"red"};fabric.Image.fromURL("avatar.png",function(e){canvas.insertAt(e,0),e.set({scaleX:.6,scaleY:.6,top:80,left:40}).set(debugTool)});const text=new fabric.Text("boring cookie no eat",{left:100,top:100,fill:"white",scale:.6,left:70}).set(debugTool);canvas.insertAt(text,1);var lis=[];function gif_generate(){var e=new GIF({workers:2,quality:10,width:460,height:460});$(".gif-images li img").each((t,a)=>{e.addFrame(a,{delay:1e3})}),e.on("finished",function(e){download(e,"avatar.gif","image/gif")}),e.render()}function pic_concat(){var e=` <li> <img src="${canvas.toDataURL("png")}" width="200px" height="200px"/> </li>`;lis.push(e),document.querySelector(".gif-images").innerHTML=lis.join("")}function update_text(){"text"==canvas.getActiveObject().type&&$("#editText").val()?refresh($("#editText").val()):alert("Choose a textarea to show your words!")}function refresh(e){canvas.getActiveObject().set("text",e),canvas.renderAll()}function downloadit(){download(canvas.toDataURL("png"),"avatar.png","image/png")}function message(e){console.log(`angle = ${e.angle}`),console.log(`scaleX = ${e.scaleX}`),console.log(`scaleY = ${e.scaleY}`),console.log(`top = ${e.top}`),console.log(`left = ${e.left}`)}function debug(){canvas.getActiveObject()?message(canvas.getActiveObject()):alert("Choose One Object to debug")}function text_listener(){$(canvas.getObjects()).each((e,t)=>{console.log(t.type),"text"==t.type&&t.on("selected",()=>{$("#editText").val(t.text),$("#editText").prop("disabled",!1)})})}$(function(){var e=new window.keypress.Listener;e.register_combo({prevent_default:!0}),e.simple_combo("cmd x",()=>{canvas.getActiveObject()?canvas.remove(canvas.getActiveObject()):alert("Choose One Object to Delete!!!")}),e.simple_combo("[",()=>{canvas.getActiveObject()?canvas.bringForward(canvas.getActiveObject()):alert("Choose One Object bring it to the top!")}),e.simple_combo("]",()=>{canvas.getActiveObject()?canvas.sendBackwards(canvas.getActiveObject()):alert("Choose One Object bring it to the bottom!")}),text_listener()});</script> </body> </html>